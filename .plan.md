# 新手教學系統實作計劃

## 一、文件結構與修改位置

### 1. HTML 結構添加 (`game.html`)

在 `<body>` 標籤末尾（約第 337 行之後）添加新手教學覆蓋層 HTML 結構。

### 2. CSS 樣式添加 (`css/style.css`)

添加新手教學相關樣式類，包括覆蓋層、高亮框、對話框等。

### 3. JavaScript 邏輯添加 (`js/game.js`)

- 在文件末尾（約第 13295 行之後）添加 `TutorialSystem` 模組
- 在 `GameFlowManager.init()` 完成後（約第 2734 行附近）初始化教學系統

---

## 二、教學步驟配置

設計 11 個教學步驟，每個步驟包含：

- `title`: 步驟標題
- `text`: 說明文字
- `highlight`: 要高亮的 CSS 選擇器（null 表示不高亮）
- `position`: 對話框位置（'top' / 'bottom' / 'center'）
- `showCondition`: 顯示條件（可選）

步驟清單（按遊戲內實際流程順序）：

**階段一：界面介紹**
1. 歡迎與遊戲目標
2. 頂部狀態欄 - 玩家資料與資源管理
2.5. 設定功能介紹 - 點擊玩家資料進入（玩家資料標籤：頭像選擇、成就、存檔管理；遊戲設定標籤：音效和音樂設定）
3. 主視窗 - 遊戲核心區域
4. 底部導航 - 功能入口

**階段二：核心遊戲流程**
5. 地區選擇 - 第一步決策（實際遊戲流程開始）
6. 景氣燈號 - 看懂市場（每個事件開始前）
7. 進貨決策 - 平衡供需（決定庫存數量）
8. 應對事件 - 七個挑戰（每輪7個事件）
9. 財務報表 - 檢視成果（完成7個事件後）

**階段三：補充說明**
10. 其他功能簡介（扭蛋機、行銷題庫、排行榜、AI助理）

**階段四：完成**
11. 開始你的冒險（完成教學）

---

## 三、HTML 結構設計

在 `game.html` 的 `<body>` 末尾添加：

```html
<!-- 新手教學覆蓋層 -->
<div id="tutorialOverlay" class="tutorial-overlay" style="display: none;">
    <!-- 高亮框 -->
    <div id="tutorialHighlight" class="tutorial-highlight"></div>
    
    <!-- 教學對話框 -->
    <div id="tutorialDialog" class="tutorial-dialog">
        <div class="tutorial-content">
            <div class="tutorial-icon">🐻</div>
            <h3 class="tutorial-title"></h3>
            <p class="tutorial-text"></p>
            <div class="tutorial-progress">
                <span class="tutorial-step-counter"></span>
            </div>
            <div class="tutorial-buttons">
                <button id="tutorialSkip" class="tutorial-btn tutorial-skip">跳過教學</button>
                <button id="tutorialPrev" class="tutorial-btn tutorial-prev">上一步</button>
                <button id="tutorialNext" class="tutorial-btn tutorial-next">下一步</button>
            </div>
        </div>
    </div>
</div>
```

---

## 四、CSS 樣式設計

在 `css/style.css` 末尾添加以下樣式類：

### 覆蓋層樣式

- `.tutorial-overlay`: 全屏半透明覆蓋層（`position: fixed`, `background: rgba(0,0,0,0.7)`, `z-index: 9999`）
- `.tutorial-highlight`: 動態高亮框（`position: absolute`, `border: 3px solid #FFD700`, `box-shadow: 0 0 0 9999px rgba(0,0,0,0.7)`, `transition: all 0.3s ease`）
- `.tutorial-highlight.hidden`: 隱藏高亮框（`display: none`）

### 對話框樣式

- `.tutorial-dialog`: 對話框容器（`position: fixed`, `z-index: 10000`, 響應式定位）
- `.tutorial-content`: 對話框內容區域（背景、邊框、陰影、圓角、像素風格）
- `.tutorial-icon`: 圖標樣式（大小、間距）
- `.tutorial-title`: 標題樣式（字體大小、顏色、邊距）
- `.tutorial-text`: 文字樣式（行高、顏色、邊距）
- `.tutorial-progress`: 進度顯示區域（字體大小、顏色）

### 按鈕樣式

- `.tutorial-btn`: 按鈕基礎樣式（邊框、背景、圓角、字體、游標）
- `.tutorial-btn:hover`: 懸停效果
- `.tutorial-btn:active`: 點擊效果
- `.tutorial-skip`: 跳過按鈕樣式（位置、顏色）
- `.tutorial-prev`: 上一步按鈕樣式
- `.tutorial-next`: 下一步按鈕樣式（主按鈕樣式）
- `.tutorial-btn.hidden`: 隱藏按鈕（`display: none`）

### 響應式設計

- 使用媒體查詢適配不同螢幕尺寸
- 對話框最小寬度、最大寬度限制
- 手機端按鈕排列調整

---

## 五、JavaScript 模組結構

在 `js/game.js` 文件末尾添加 `TutorialSystem` 物件，包含以下方法：

### 核心屬性

- `steps`: 教學步驟配置陣列
- `currentStep`: 當前步驟索引（從 0 開始）
- `overlay`: 覆蓋層 DOM 元素
- `highlight`: 高亮框 DOM 元素
- `dialog`: 對話框 DOM 元素

### 核心方法

#### `init()`

- 獲取 DOM 元素引用
- 綁定事件監聽器（下一步、上一步、跳過）
- 檢查是否需要顯示教學

#### `show()`

- 顯示覆蓋層和對話框
- 顯示第一步驟
- 禁用遊戲其他互動（可選）

#### `showStep(stepIndex)`

- 根據步驟索引顯示對應內容
- 更新標題、文字、進度計數器
- 控制按鈕顯示/隱藏狀態
- 更新高亮框位置和大小

#### `next()`

- 執行下一步驟
- 如果是最後一步，改為「完成」按鈕

#### `prev()`

- 返回上一步驟
- 第一步時隱藏「上一步」按鈕

#### `skip()`

- 顯示確認對話框（使用現有的 `showConfirmModal` 函數）
- 確認後標記教學完成並關閉

#### `complete()`

- 標記教學完成（`localStorage.setItem('tutorialCompleted', 'true')`）
- 隱藏覆蓋層
- 恢復遊戲互動

#### `updateHighlight(elementSelector)`

- 根據選擇器獲取目標元素
- 計算元素位置和大小（`getBoundingClientRect()`）
- 更新高亮框位置、寬度、高度
- 更新對話框位置（避免被高亮元素遮擋）

#### `calculateDialogPosition(highlightElement, position)`

- 根據高亮元素位置和對話框位置參數計算對話框位置
- 處理邊界情況（貼邊、超出螢幕等）

#### `isCompleted()`

- 檢查 `localStorage.getItem('tutorialCompleted')`
- 返回布林值

#### `hide()`

- 隱藏覆蓋層和所有教學元素

---

## 六、整合點與觸發時機

### 在 `game.js` 的初始化流程中

位置：`GameFlowManager.init()` 執行完成後（約第 2734 行附近）

```javascript
// 初始化教學系統
if (!TutorialSystem.isCompleted() && 
    !localStorage.getItem('selectedRegion')) {
    // 延遲顯示，確保所有元素已渲染
    setTimeout(() => {
        TutorialSystem.init();
        TutorialSystem.show();
    }, 500);
}
```

條件：

- 教學未完成（`!TutorialSystem.isCompleted()`）
- 首次進入遊戲（未選擇地區）

---

## 七、教學內容配置

每個步驟的詳細內容配置（在 `TutorialSystem.steps` 陣列中）：

### 階段一：界面介紹

#### 步驟 1：歡迎

- title: "歡迎來到《熊熊烘焙所》！"
- text: "你的目標是讓麵包店起死回生！每輪遊戲你需要：1. 選擇合適的地區開店 2. 決定進貨數量 3. 看懂市場景氣燈號 4. 應對7個隨機事件 5. 查看財務報表檢視成果"
- highlight: null
- position: "center"

#### 步驟 2：頂部狀態欄

- title: "你的玩家資料與資源狀態"
- text: "頂部狀態欄分為兩個部分：左側是玩家資料（顯示你的頭像和名稱），右側是遊戲資源：🍯 蜂蜜幣（主要貨幣，用於進貨和日常開銷）、🐻 熊點數（遊戲進度點數，可用於扭蛋機）、🏆 勳章（成就獎勵，反映你的經營表現）。你可以點擊玩家資料進入設定，記住：妥善管理資源是成功的關鍵！"
- highlight: ".header"
- position: "bottom"
- 說明：同時介紹左側玩家資料（頭像、名稱）和右側資源（蜂蜜幣、熊點數、勳章），並提示可以點擊進入設定

#### 步驟 2.5：設定功能（點擊玩家資料進入）

- title: "設定功能介紹"
- text: "點擊頂部狀態欄的玩家資料，會進入設定畫面。設定包含兩個標籤頁：「玩家資料」和「遊戲設定」。在「玩家資料」標籤中，你可以：修改頭像（從已解鎖的頭像中選擇）、查看成就進度、綁定/解除綁定電子郵件、備份存檔、載入存檔、清除進度。在「遊戲設定」標籤中，你可以：開啟/關閉音效、調整音效音量、開啟/關閉背景音樂、調整音樂音量。所有設定都會自動保存！"
- highlight: ".player-info"（提示點擊玩家資料區域）
- position: "bottom"
- 說明：介紹設定功能的所有選項，包括玩家資料標籤（頭像選擇、成就、存檔管理）和遊戲設定標籤（音效和音樂設定）

#### 步驟 3：主視窗

- title: "遊戲主視窗"
- text: "這裡是遊戲的核心操作區域，會根據你的操作顯示：地區選擇畫面、進貨管理界面、劇情、隨機事件和選項、財務報表結果。所有重要的決策都在這裡進行！"
- highlight: ".main-window"
- position: "bottom"

#### 步驟 4：底部導航

- title: "功能導航欄"
- text: "底部有五個主要功能：🎰 扭蛋機（使用蜂蜜幣抽取獎勵）、📦 事件（返回事件，這是遊戲核心）、📚 行銷題庫（學習行銷知識）、🏅 排行榜（查看排名）、💬 AI助理（AI 助手協助）。大部分時間你會使用「事件」功能！"
- highlight: ".navigation"
- position: "top"

### 階段二：核心遊戲流程（按照遊戲內實際順序）

#### 步驟 5：地區選擇（遊戲流程第一步）

- title: "選擇你的開店地點"
- text: "遊戲開始時，你需要選擇地區：🏠 住宅區（穩定客源，競爭較少）、🏢 商業區（客流量大，但競爭激烈）、🎓 學區（學生客群，有季節性變化）。每個地區有不同的市場係數，會影響你的銷售表現。選擇時要考慮自己的經營策略！"
- highlight: ".main-window"（當顯示地區選擇畫面時）
- position: "bottom"
- showCondition: "只在首次進入且未選擇地區時顯示"
- 說明：這是實際遊戲流程的第一步

#### 步驟 6：景氣燈號（每個事件開始前顯示）

- title: "景氣燈號是你的指南針"
- text: "每個事件開始前，會顯示「景氣燈號」：🟢 綠燈（景氣平穩，市場穩定）、🔴 紅燈（市場熱絡，需求旺盛，但進貨成本可能較高）、🔵 藍燈（景氣不佳，需求降低，但進貨成本較低）。就像天氣預報一樣，它告訴你當天的市場狀況，幫助你做出更好的決策！"
- highlight: ".main-window"（提示會在事件中顯示）
- position: "center"
- 說明：在遊戲流程中，這是每個事件開始前的第一步

#### 步驟 7：進貨決策（根據景氣燈號決定）

- title: "聰明進貨，避免浪費"
- text: "根據景氣燈號和資金狀況決定進貨：進太少可能缺貨，失去銷售機會；進太多會造成報廢，浪費成本。技巧：紅燈時可適度增加進貨，藍燈時要謹慎控管！記住：庫存管理是經營成功的關鍵！"
- highlight: ".main-window"（提示進貨功能位置）
- position: "bottom"
- 說明：在遊戲流程中，這是看到景氣燈號後的第二步

#### 步驟 8：應對事件（每輪7個事件）

- title: "每輪七個事件考驗你"
- text: "每一輪會有7個隨機事件，包含：產品 (Product)、價格 (Price)、通路 (Place)、推廣 (Promotion)、危機管理。每個事件都有多個選項，你的選擇會影響：💰 營收與成本（直接影響獲利）、⭐ 聲望（品牌信任度）、😊 顧客滿意度（影響回頭客）。記住：沒有標準答案，要根據情況靈活應對！"
- highlight: ".main-window"（事件顯示區域）
- position: "bottom"
- 說明：在遊戲流程中，這是進貨後的第三步，每輪需要完成7個事件

#### 步驟 9：財務報表（完成7個事件後）

- title: "回顧經營成果"
- text: "完成7個事件後，會生成財務報表，顯示：總營收（當日收入總和）、總成本（進貨與事件成本）、淨利潤（盈虧狀況）、聲望變化（品牌形象改變）、滿意度變化（顧客評價）。這份報表幫助你：了解策略是否有效、為下一輪做出更明智的決策、持續改善經營方式！"
- highlight: ".main-window"（財務報表顯示區域）
- position: "bottom"
- 說明：在遊戲流程中，這是完成7個事件後的結算畫面

### 階段三：補充說明

#### 步驟 10：其他功能簡介

- title: "探索更多功能"
- text: "除了核心經營，還有：🎰 扭蛋機（用蜂蜜幣抽獎，獲得資源獎勵）、📚 行銷題庫（學習行銷知識，提升決策能力）、🏅 排行榜（與其他玩家競爭排名）、💬 AI助理（AI 助手隨時為你解答疑問）。先專注掌握核心流程，其他功能可以慢慢探索！"
- highlight: ".navigation"（依次高亮各功能按鈕）
- position: "top"
- 說明：這些功能在遊戲過程中可以隨時使用，不影響核心流程

### 階段四：完成

#### 步驟 11：開始你的冒險

- title: "準備好了嗎？"
- text: "教學完成！現在你已經了解：✓ 遊戲目標（讓麵包店起死回生）、✓ 核心流程（地區→景氣→進貨→事件→報表）、✓ 決策重點（平衡成本與收益，提升聲望和滿意度）。記住：每個選擇都重要，但也要享受經營的樂趣！祝你的麵包店生意興隆！🐻🍞"
- highlight: null
- position: "center"
- 按鈕文字：最後一步的「下一步」按鈕改為「開始遊戲」

---

## 八、動畫效果設計

### 覆蓋層動畫

- 淡入淡出效果（`animation: fadeIn 0.3s ease-in`）
- 使用 CSS `@keyframes` 定義動畫

### 對話框動畫

- 滑入滑出效果（`animation: slideIn 0.3s ease-out`）
- 從下方或上方滑入（根據位置參數）

### 高亮框動畫

- 縮放效果（`animation: scaleIn 0.3s ease-out`）
- 平滑過渡位置變化（`transition: all 0.3s ease`）

---

## 九、狀態管理

### localStorage 鍵名

- `tutorialCompleted`: 教學是否完成（布林值，字符串形式：'true' / 'false'）

### 檢查邏輯

```javascript
isCompleted() {
    return localStorage.getItem('tutorialCompleted') === 'true';
}
```

### 完成標記

```javascript
complete() {
    localStorage.setItem('tutorialCompleted', 'true');
    // ... 其他邏輯
}
```

---

## 十、響應式設計考量

### 桌面端（> 768px）

- 對話框寬度：最大 600px
- 對話框間距：高亮元素 20px
- 按鈕排列：水平排列

### 平板端（481px - 768px）

- 對話框寬度：最大 80%
- 對話框間距：高亮元素 15px
- 按鈕排列：水平排列

### 手機端（≤ 480px）

- 對話框寬度：90%
- 對話框間距：高亮元素 10px
- 按鈕排列：垂直排列（跳過按鈕在頂部）
- 字體大小：適當縮小

---

## 十一、錯誤處理與邊界情況

### DOM 元素不存在

- 檢查元素是否存在再操作
- 使用 `querySelector` 並檢查返回值

### 高亮元素不可見

- 檢查元素是否在 DOM 中
- 檢查元素是否可見（`offsetParent !== null`）
- 如果不可見，不高亮或顯示在中央

### 對話框超出螢幕

- 使用 `calculateDialogPosition` 處理邊界
- 自動調整位置，確保對話框可見

### localStorage 不可用

- 使用 try-catch 包裹
- 降級處理：如果 localStorage 不可用，仍然顯示教學

---

## 十二、可選進階功能（未來擴展）

### 1. 重新查看教學

- 在左側玩家資料中添加「重新查看教學」選項
- 清除 `tutorialCompleted` 並重新顯示教學

### 2. 音效支持

- 步驟切換音效
- 完成教學音效
- 按鈕點擊音效（使用現有音效系統）

### 3. 進度條

- 顯示教學進度條
- 視覺化進度（例如：進度條填充）

### 4. 互動式引導

- 某些步驟要求玩家實際操作（例如：點擊導航按鈕）
- 只有在完成操作後才能繼續

---

## 十三、測試檢查清單

- [ ] 教學正確顯示在首次進入時
- [ ] 教學完成後不再顯示
- [ ] 所有按鈕功能正常（下一步、上一步、跳過）
- [ ] 高亮框正確定位到目標元素
- [ ] 對話框正確定位，不遮擋高亮元素
- [ ] 響應式設計在各設備上正常顯示
- [ ] 動畫效果流暢
- [ ] localStorage 正確保存狀態
- [ ] 跳過功能正確標記完成狀態
- [ ] 完成教學後遊戲正常繼續

---

## 十四、實作順序建議

1. **第一階段：基礎結構**
   - 添加 HTML 結構
   - 添加基礎 CSS 樣式
   - 創建 `TutorialSystem` 骨架

2. **第二階段：核心功能**
   - 實現步驟配置
   - 實現顯示/隱藏邏輯
   - 實現下一步/上一步功能

3. **第三階段：高亮與定位**
   - 實現高亮框定位
   - 實現對話框定位
   - 處理邊界情況

4. **第四階段：美化與動畫**
   - 添加動畫效果
   - 調整樣式細節
   - 優化響應式設計

5. **第五階段：整合與測試**
   - 整合到遊戲初始化流程
   - 測試所有功能
   - 修復問題並優化

---

## 十五、注意事項

1. **不中斷遊戲邏輯**
   - 教學系統應該獨立於遊戲核心邏輯
   - 教學期間可以暫停某些互動，但不應破壞遊戲狀態

2. **性能考量**
   - 避免頻繁的 DOM 查詢
   - 緩存 DOM 元素引用
   - 使用 CSS 動畫而非 JavaScript 動畫（性能更好）

3. **無障礙設計**
   - 確保文字顏色對比度足夠
   - 支持鍵盤導航（Tab、Enter、Esc）
   - 提供清晰的視覺反饋

4. **可維護性**
   - 步驟配置與邏輯分離
   - 使用清晰的變量名和函數名
   - 添加必要的註釋

---

## 十六、文件修改摘要

### 修改的文件

1. `game.html` - 添加教學覆蓋層 HTML 結構
2. `css/style.css` - 添加教學相關 CSS 樣式
3. `js/game.js` - 添加 `TutorialSystem` 模組和初始化邏輯

### 新增的功能

- 新手教學覆蓋層系統
- 高亮框定位系統
- 對話框響應式定位系統
- 教學狀態管理系統

### 預期效果

- 首次進入遊戲時自動顯示新手教學
- 11 個步驟完整引導玩家了解遊戲
- 教學完成後不再顯示
- 提供跳過和重新查看功能

---

計劃完成！可以開始實作了。

